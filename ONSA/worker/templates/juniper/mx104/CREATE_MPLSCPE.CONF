{% if vrf_exists is not True %}
set routing-instances {{ vrf_name }} route-distinguisher {{ loopback }}:{{ vpn_id }}
set routing-instances {{ vrf_name }} vrf-target target:64600:{{ vpn_id }}
{% endif %}

set interfaces {{ an_uplinkInterface }}.{{ an_logicalUnit }} description "{{ description }}"
set interfaces {{ an_uplinkInterface }}.{{ an_logicalUnit }} vlan-tags outer {{ an_qinqOuterVlan }}
set interfaces {{ an_uplinkInterface }}.{{ an_logicalUnit }} vlan-tags inner {{ an_qinqInnerVlan }}
set interfaces {{ an_uplinkInterface }}.{{ an_logicalUnit }} family inet address 100.64.0.1/23
set routing-instances {{ vrf_name }} interface {{ an_uplinkInterface }}.{{ an_logicalUnit }}


{% if bgp_groups is defined -%}
{% for bgp_group in bgp_groups -%}
set routing-instances {{vpn}} protocols bgp group CPE-{{bgp_group['peer_as']}} type external
set routing-instances {{vpn}} protocols bgp group CPE-{{bgp_group['peer_as']}} description "{{bgp_group['description']}}"
set routing-instances {{vpn}} protocols bgp group CPE-{{bgp_group['peer_as']}} peer-as {{bgp_group['peer_as']}}
set routing-instances {{vpn}} protocols bgp group CPE-{{bgp_group['peer_as']}} neighbor {{bgp_group['neighbor']}}
{% endfor -%}
{% endif %}


// ToDo